=== Create a search

____

This scenario demonstrates how to find recent _documents_ with information about a company's dividends.

*Expected results*:

* _Documents_ in the response must contain positive statements about the dividends of *Exxon Mobil* (for example purposes, but any company is OK).
* The _search_ is limited to the last 90 days.
* The _search_ is a _permanent search_ to be invoked or modified at any later time.

*Related topics*: <<general/overview.adoc#reference-api,Reference API>>, <<general/overview.adoc#search-api,Search API>>, <<devdata/search.adoc#introduction-to-a-search,Introduction to a _search_>>.

____

[float]
==== 1. Find the unique ID of a company

First, find the InfoNgen ID of the Exxon Mobil company to create the future _search_.

Each company in the InfoNgen _taxonomy_ is represented by the corresponding value of the `company` _tag_.
The `company` _tag_ has a `display` property that contains the name of the company, and a `value` property that contains the unique ID of the company.

To find the necessary _tag_ and its value for *Exxon Mobil*, run the `GET reference/tags/{{tagname}}` request (see https://api.infongen.com/v2[_InfoNgen API Reference Portal_]).
Ask for all values of the `company` tag that contain the text "exxon":

----
curl --location --request GET '{{API_link}}/reference/tags/company?text=exxon' \
--header 'x-api-key: {{x-api-key}}' \
--header 'Authorization: Bearer {{access_token}}'
----

The request returns a list of companies with the word "exxon" in the title&mdash;the list of the `company` _tag_ values containing "exxon" in the `display` property value.

.Click here for Reference API response with five companies found (five values of the `company` _tag_).
[%collapsible]
====
----
HTTP/1.1 200 OK
X-Total: 5
----
[source,json]
----
[
    {
        "name": "company",
        "display": "Company",
        "primary": false,
        "values": [
            {
                "value": "100003436",
                "display": "Exxon Mobil Corp",
                "displayshort": "XOM:NYX",
                "root": true,
                "has_children": true
            },
            {
                "value": "100322236",
                "display": "Exxonmobil Canada Ltd.",
                "root": true,
                "has_children": false
            },
            {
                "value": "100322239",
                "display": "Exxonmobil Central Europe Holding Gmbh",
                "root": false,
                "parenttags": [
                    {
                        "name": "company",
                        "value": "100003436"
                    }
                ],
                "has_children": false
            },
            {
                "value": "100322247",
                "display": "Exxonmobil Development Company",
                "root": false,
                "parenttags": [
                    {
                        "name": "company",
                        "value": "100003436"
                    }
                ],
                "has_children": false
            },
            {
                "value": "100645380",
                "display": "ExxonMobil Chemical",
                "root": true,
                "has_children": false
            }
        ]
    }
]

----
====

The value of *Exxon Mobil* _tag_ is `100003436`.

[float]
==== 2. Create a search for "Exxon Mobil"

Create a _search_ by running a `POST searches` request.
The conditions of the _search_ are constructed in the following way:

* The necessary value of the `"company"` _tag_ is put in the `"conditions"` array. +
* The _sentiments_ about a company are listed in the `"sentiments_conditions"` array.
It has 4 JSON objects that must be populated with the necessary values:
** The `"subject": {"type": "company","value": "100003436"}`.
** The `"aspect": "dividends"`. +
*Tip*: to get the complete list of available values for the `"aspect"` _tag_, run the `GET reference/tags/aspect` request.
** the `"polarity": "positive"` to look for positive statements.
** the logical operator `"operator": "AND"` to combine these conditions. +
* The `"search_settings"` object contains the `{"date_range": "Last90Days"}` object. +
* To make a _search_ permanent, give the _search_ a name.
Set the name in the query `search_name=exxon`.

----
curl --location --request POST '{{API_link}}/searches/?redirect_to_results=true' \
--header 'Content-Type: application/json' \
--header 'x-api-key: {{x-api-key}}' \
--header 'Authorization: Bearer {{access_token}}' \
--data-raw '
----
[source,json]
----
'{
    "conditions":[
      {
        "name": "company",
        "values":[
          "100003436"
        ]
      }
    ],
    "sentiment_conditions":[
      {
        "subject":{
          "type":"company",
          "value":"100003436"
        },
        "polarity":"positive",
        "operator":"AND",
        "aspect":"Dividends"
      }
    ],
    "search_settings":{
      "date_range":"Last90Days"
    }
}'
----
The request creates a _permanent search_ with a unique ID `"7b6d78ca-a40f-4b24-9528-24200398c7b9"`. +
By default, every _search_ that is successfully created by InfoNgen has a `redirect_to_results=true` query parameter.
It redirects to the `GET searches/{{search_uid}}/results` endpoint, where InfoNgen returns the _documents_ that satisfy the criteria of the _search_.

.Click here for Search API response with the results of the `search`.
[%collapsible]
====
The response is truncated for brevity.

----
HTTP/1.1 303 See Other
Location: {{API_link}}/searches/7b6d78ca-a40f-4b24-9528-24200398c7b9/results?show_options=search_info,documents&limit=10&page=1

HTTP/1.1 200 OK
----

[source,json]
----
{
    "documents": [
        {
            "category": "Professional Industry Publications",
            "contributor": "EIN News",
            "headline": "This Oil Stock Will Benefit From Higher Oil Prices",
            "id": "8458346835",
            "published_at": "2019-09-26T02:50:33.566Z",
            "sentiments": [
                {
                    "subject": {
                        "display_name": "PrimaryCompany",
                        "name": "company",
                        "values": [
                            {
                                "display_value": "Exxon Mobil Corp",
                                "display_value_short": "XOM:NYX",
                                "value": "100003436"
                            }
                        ]
                    },
                    "polarities": [
                        {...},
                        {
                            "aspects": [...],
                            "polarity": "positive",
                            "text": [
                                "Dividend Aristocrats are those companies with at least 25 consecutive years of dividend growth.",
                                "Exxon Mobil has increased its dividend:",
                                "Dividend growth is likely to continue going forward, but investors should be aware that payout ratios are elevated.",
                                "While shares are expensive against our target valuation, investors are likely to see double-digit annual returns from shares of Exxon Mobil through 2024.",
                                "Exxon Mobil has managed to increase its dividend for nearly four decades.",
                                "Still, the stock offers a very attractive dividend yield.",
                                "Production increased against a soft comparison base, but had a slight decline from the first quarter of 2019.",
                                "The company has an impressive history of dividend growth, especially since its business is so closely tied to the price of a commodity that has undergone several severe downturns.",
                                "One of the top oil stocks that we believe will perform well over the next five years is Exxon Mobil (NYSE:XOM).",
                                "Dividend analysis and total returns.",
                                "Despite a poor showing in the second quarter, there are some positives for Exxon Mobil.",
                                "Reverting to our target price-earnings ratio by 2024 would reduce annual returns by 8.8% over this period of time.",
                                "Shares of the company yield 4.8%, which is much higher than the 10-year average yield of 3.1% and more than double the average yield of the S&P 500.",
                                "The company has increased its dividend for 37 consecutive years.",
                                "Exxon Mobil has spent heavily to increase its production, but this has caused earnings per share and free cash flow payout ratios to become extremely high.",
                                "We have a 2024 target price-earnings ratio of 13, which is closer to the average multiple prior to the oil price decline seen in the middle of this decade.",
                                "More recently, Exxon Mobil increased its dividend by 6.1% for the June 10 payment."
                            ]
                        }
                    ],
                    "text": [...]},
                {...},
                {...}
            ],
            "source": "EIN News | EIN * Oil & Gas News",
            "summary": "… the day following the attack. Oil prices have come down since,
             … high total returns, particularly if oil prices continue to rally.
              One … aftermath of the collapse in oil price between 2014 and 2016.
              … average multiple prior to the oil price decline seen in the …",
            "tags": [...],
            "uri": "https://{{Discovery_Portal_base_address}}.infongen.com/searches/documents/8458346835",
            "sharing_allowed": true
        },
        {...}
    ],
    "documents_total": 55,
    "search_info": {
        "uid": "7b6d78ca-a40f-4b24-9528-24200398c7b9",
        "visibility": {
            "scope": "owner"
        },
        "created_at": "2019-10-01T08:56:03.446Z",
        "updated_at": "2019-10-01T08:56:03.446Z",
        "creator": "{{your_unique_user_id}}"
    }
}
----
====
*Results*: the _search_ returns 55 _documents_ (`"documents_total": 55`).
One is given in the response (the `"uri"` property is the link to that _document_) with a positive _sentiment_ that is given within the `"text"` field:
____
...Exxon Mobil has increased its dividend...
...The company has increased its dividend for 37 consecutive years...
...More recently, Exxon Mobil increased its dividend by 6.1% for the June 10 payment.
____

'''

image:icons/lightbulb.png[alt=Note icon, width="60", float="left"] Use the WebSocket-based `PUT searches/{{search_uid}}/subscription` method to receive new _documents_ in real time. +
See <<devdata/search.adoc#receiving-search-results-in-real-time,Receiving search results in real time>> section).
